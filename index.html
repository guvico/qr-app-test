<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>qr.guvico.com</title>
</head>
<body>
    <!-- <h1> <span id='counter'></span> </h1> -->
    <!-- <div id="content"></div> -->
    <script type="text/javascript">
        // var counterElt = document.getElementById("counter");
        function directURL() {
            var userAgent = window.navigator.userAgent,
                platform = window.navigator.platform,
                macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'],
                windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'],
                iosPlatforms = ['iPhone', 'iPad', 'iPod'],
                os = null;

                const temp = window;
                console.log(temp, 'temp');
                console.log(temp.navigator, 'temp.navigator');
                console.log(temp.navigator.userAgent, 'temp.navigator.userAgent');
                console.log(window.screen.availHeight, 'sss');
                console.log(window.screen.availWidth, 'sss');
                console.log(window.history, 'sss');
                console.log(window.navigator.cookieEnabled, 'sss');
                console.log(window.navigator.appCodeName, 'sss');
                console.log(window.navigator.platform, 'sss');
                console.log(window.navigator.os, 'sss');

                const token = window.screen.availWidth.toString() +
                window.screen.availHeight.toString() +
                window.navigator.platform
                // window.navigator.iosPlatforms+
                // window.navigator.hardwareConcurrency+
                // window.navigator.os+
                // window.navigator.mediaDevices.enumerateDevices()+
                // window.navigator.vendor+
                // window.navigator.vendorSub
                // document.getElementById("content").innerHTML = token

                const get = window.navigator.ur
                // const url = `http://?code=0389888952`
                let query = getParameterByName('code') || null;
                let url = `https://guvico-be-develop.up.railway.app/invite/set_invite`

            if(query !== null) {
              navigator.clipboard.writeText(code).then(() => {
                console.log("Copied to clipboard:", code);
                // optional: alert("Đã copy mã giới thiệu");
              });
              url = `https://guvico-be-develop.up.railway.app/invite/set_invite?code=${query}`
            } else {
              url = `https://guvico-be-develop.up.railway.app/invite/set_invite`
            }

                  // console.log(url, 'url');
                
            if (macosPlatforms.indexOf(platform) !== -1) {
                os = 'Mac OS';
            } else if (iosPlatforms.indexOf(platform) !== -1) {
                os = 'iOS';
            } else if (windowsPlatforms.indexOf(platform) !== -1) {
                os = 'Windows';
            } else if (/Android/.test(userAgent)) {
                os = 'Android';
            } else if (!os && /Linux/.test(platform)) {
                os = 'Linux';
            }
            const payload = {
              token: token
              // window: JSON.parse(temp.navigator)
            }

             callAPI('POST', url, payload).then()

            if (os === "iOS") {
                // window.location.href = `itms-apps://itunes.apple.com/app/apple-store/id6443966297?mt=8`;

                window.location.assign(`itms-apps://itunes.apple.com/app/apple-store/id6443966297?mt=8`);

                // window.location.assign('https://apps.apple.com/us/app/guvi-gi%C3%BAp-vi%E1%BB%87c-theo-gi%E1%BB%9D/id6443966297');
                // window.location.href = `https://apps.apple.com/vn/app/guvi/id6443966297?l=vi`;
                // window.location.href = `https://itunes.apple.com/us/app/keynote/id6443966297?mt=8`;
                
            } else if (os === 'Android') {
                // window.location.href = `market://details?id=com.guvico_customer`;
                window.location.assign('market://details?id=com.guvico_customer')
            } else {
                // window.location.href = `itms-apps://itunes.apple.com/app/apple-store/id6443966297?mt=8`;
                // window.location.href = `https://play.google.com/store/apps/details?id=com.guvico_customer`;
                window.location.assign(`https://play.google.com/store/apps/details?id=com.guvico_customer`);
                // window.location.assign('market://details?id=com.guvico_customer')

            }
        }
        // var intervalId = setInterval(decreaseCounter, 0);

        async function getAPI(method, url) {
  // Default options are marked with *
  // return new Promise((resolve, reject) => {
    return await fetch(url, {
      method: method || 'GET', // *GET, POST, PUT, DELETE, etc.
      mode: 'cors', // no-cors, *cors, same-origin
      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
      credentials: 'same-origin', // include, *same-origin, omit
      headers: {
        'Content-Type': 'application/json'
        // 'Content-Type': 'application/x-www-form-urlencoded',
      },
      redirect: 'follow', // manual, *follow, error
      referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
    }).then(response => {
      console.log(response.status, 'response');
      return response.json().then(data => {
        console.log(data, 'data');
        if(response.status !== 200) {
          // callToast(data.message || data, "fail");
        } else {
          // callToast('Cập nhật thành công', "success");
        }
        return {
          data: data,
          status: response.status
        }
      })
    }).catch(err => {
      console.log(err, 'err');
    });
    // });

   // parses JSON response into native JavaScript objects
}


async function callAPI(method, url, payload) {
  console.log(payload, 'payload');
  // Default options are marked with *
  // return new Promise((resolve, reject) => {
    return await fetch(url, {
      method: method || 'GET', // *GET, POST, PUT, DELETE, etc.
      mode: 'cors', // no-cors, *cors, same-origin
      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
      credentials: 'same-origin', // include, *same-origin, omit
      headers: {
        'Content-Type': 'application/json'
        // 'Content-Type': 'application/x-www-form-urlencoded',
      },
      redirect: 'follow', // manual, *follow, error
      referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
      body: JSON.stringify(payload) // body data type must match "Content-Type" header
    }).then(response => {
      console.log(response.status, 'response');
      return response.json().then(data => {
        console.log(data, 'data');
        if(response.status !== 200) {
          callToast(data.message || data, "fail");
        } else {
          callToast('Cập nhật thành công', "success");
        }
        return {
          data: data,
          status: response.status
        }
      })
    }).catch(err => {
      console.log(err, 'err');
    });
    // });

   // parses JSON response into native JavaScript objects
}


function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}
        window.onload = directURL;
    </script>

</body>

</html>
